@using Repository.Models.DatabaseModels
@using Microsoft.AspNetCore.Identity
@model Repository.ViewModels.ProjectAndFilesViewModel
@inject UserManager<User> _userManager

@{
  ViewData["Title"] = "Страница проекта";
  var user = _userManager.FindByIdAsync(Model.Project.UserId).Result;
  var manager = _userManager.FindByIdAsync(Model.Project.ProjectManagerId).Result;
}
<h2 >Страница курсовго проекта</h2>
<div class="row justify-content-center mt-3 mx-1">
  <div class="col-md-8 mx-0">
    <div class="card mt-3">
      <div class="card-body">
        <h4 class="card-title mb-1">Тема курсового проекта: @Model.Project.Title </h4>
        <h5 class="card-title text-muted">Дисциплина: @Model.Project.Discipline.Name </h5>
        <h6 class="card-subtitle text-muted mt-4">
          Создано: <a href="mailto:@user.Email">@user.Email</a><br>
          фИО: @user.Surname @user.FirstName @user.Patronymic
        </h6>
        @if (user.GroupNumber != null)
        {
          <h6 class="text-muted mb-0">Номер групы: @user.GroupNumber</h6>
        }
        <h6 class="text-muted mb-5">Дата создания: @Model.Project.CreationDate</h6>
        
        <div class="jumbotron p-3">
          <h5 class="card-subtitle">Описание курсового проекта:</h5>
          <br>
          <p class="card-text mt-2">
            @Model.Project.Description
          </p>
        </div>

        <h6 class="card-subtitle text-muted">
          Руководитель проекта: <a href="mailto:@manager.Email">@manager.Email</a><br>
          @manager.Surname @manager.FirstName @manager.Patronymic
        </h6>
      </div>
      @if (User.IsInRole("Admin"))
      {
        <div class="card-footer d-flex flex-column  justify-content-center">

          <a class="btn btn-outline-primary my-1" asp-controller="Projects"
             asp-action="EditProject" asp-route-id="@Model.Project.Id">
            Редактировать
          </a>
          <a class="btn btn-outline-danger my-1" asp-controller="Projects"
             asp-action="DeleteProject" asp-route-id="@Model.Project.Id">
            Удалить
          </a>
        </div>
      }

    </div>

    <div class="mt-3 card card-body">
      <h3>Все файлы:</h3>
      @if (!Model.FileModels.Any())
      {
        <p>К проекту не привязано файлов.</p>
      }
      @foreach (var f in Model.FileModels)
      {
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            @if (User.IsInRole("Admin") || User.IsInRole("Teacher"))
            {
              <a class="btn btn-outline-info" asp-controller="Files"
                 asp-action="TryDownloadFile" asp-route-fileId="@f.Id">
                Скачать
              </a>
            }
            @f.Name
          </li>
        </ul>
      }
    </div>
  </div>
</div>